# Story 1.3: Admin Interface and Program Creation

## Status

Draft

## Story

**As an** admin user,
**I want** a functional PayloadCMS admin interface with embedded program editing,
**so that** I can create and manage complete workout programs from a single interface without context switching.

## Acceptance Criteria

1. **Admin authentication** works with PayloadCMS built-in user system
2. **Single-page program creation** allows creating complete programs with embedded milestones, days, and exercises
3. **Exercise library management** enables adding, editing, and organizing exercises
4. **Embedded milestone editing** allows defining themes, objectives within the program interface
5. **Embedded day management** enables creating workout and rest days with exercises directly in the program
6. **Embedded exercise configuration** allows adding exercises with sets, reps, rest periods, weight, and notes within days
7. **Conditional field visibility** shows exercises array only for workout days and rest notes only for rest days
8. **Progressive validation** allows saving incomplete programs as drafts while preventing publishing incomplete content
9. **Drag-and-drop ordering** enables reordering milestones, days, and exercises within the program interface
10. **Collapsible sections** manage complexity with expandable/collapsible milestone and day sections
11. **Admin interface is responsive** and works on desktop for program creation
12. **All CRUD operations** work correctly for all collection types

## Tasks / Subtasks

- [ ] **Enable/verify admin authentication (Payload default users)** (AC: 1)
  - [ ] Confirm `users` collection uses Payload auth and admin UI is accessible
  - [ ] Verify access control on admin-only collections
  - [ ] Smoke test login/logout
  - [Source: architecture/payloadcms-collections.md#users-collection-payloadcms-admin-users]

- [ ] **Programs collection embedded editing UX** (AC: 2, 4, 5, 6, 7, 9, 10)
  - [ ] Ensure `programs` has embedded `milestones -> days -> exercises` arrays
  - [ ] Verify conditional display for workout vs rest day fields
  - [ ] Verify drag-and-drop ordering on arrays and collapsed sections
  - [ ] Ensure admin descriptions/labels guide editors
  - [Source: architecture/payloadcms-collections.md#programs-collection-embedded-architecture]

- [ ] **Exercise library management** (AC: 3)
  - [ ] Confirm CRUD operations for `exercises` with title, description, video URL, alternatives
  - [ ] Ensure alternatives relationship is functional
  - [Source: architecture/payloadcms-collections.md#exercises-collection]

- [ ] **Progressive validation + publishing controls** (AC: 8)
  - [ ] Verify draft saves without required fields
  - [ ] Validate publishing is blocked until required fields present; error messaging clear
  - [Source: architecture/payloadcms-collections.md#progressive-validation-strategy]

- [ ] **Access control checks** (AC: 12)
  - [ ] Confirm admin-only access to collections via Payload access config
  - [ ] Verify CRUD works for `programs`, `exercises`, `productUsers`, `exerciseCompletions`
  - [Source: architecture/payloadcms-collections.md#payloadcms-first-architecture]

- [ ] **Admin interface responsiveness** (AC: 11)
  - [ ] Manual check of Payload admin on desktop sizes
  - [ ] Verify embedded UI remains usable as arrays grow
  - [Source: architecture/frontend-architecture.md#component-architecture]

- [ ] **Testing**
  - [ ] Update/extend integration tests for embedded admin configuration (arrays, conditional fields)
  - [ ] Verify Payload type generation and TS compilation
  - [ ] Ensure E2E admin smoke path (optional manual) is documented
  - [Source: architecture/testing-strategy.md#testing-pyramid]

## Dev Notes

### Previous Story Insights

- Story 1.2 replaced normalized milestones/sessions with an embedded structure and added progressive validation and conditional UI in the `programs` collection. Reuse those hooks and admin config for this storyâ€™s validation and UX.

### Architecture References (implementation guidance)

- Admin users vs product users separation; use Payload default auth for admins only
  - [Source: architecture/payloadcms-collections.md#admin-user-vs-product-user-separation-strategy]
  - [Source: architecture/payloadcms-collections.md#users-collection-payloadcms-admin-users]

- Programs embedded schema fields, conditional visibility, drag-and-drop, collapsible sections, and publishing control
  - [Source: architecture/payloadcms-collections.md#programs-collection-embedded-architecture]

- Exercise library fields and relationships
  - [Source: architecture/payloadcms-collections.md#exercises-collection]

- Progressive validation strategy for drafts vs publish
  - [Source: architecture/payloadcms-collections.md#progressive-validation-strategy]

- Project structure location for Payload collections and admin routes
  - `src/payload/collections/*.ts`, `src/app/(payload)/admin/`
  - [Source: architecture/unified-project-structure.md]
  - [Source: architecture/frontend-architecture.md#route-organization]

- Testing scope and organization
  - [Source: architecture/testing-strategy.md#testing-pyramid]

## Change Log

| Date       | Version | Description                         | Author   |
| ---------- | ------- | ----------------------------------- | -------- |
| 2025-09-08 | 0.1     | Initial draft created from PRD/Arch | Bob (SM) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_
