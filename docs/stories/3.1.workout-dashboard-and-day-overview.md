# Story 3.1: Workout Dashboard and Day Overview

## Status
Ready for Development

## Story
**As a** product user,  
**I want** to see my current workout day overview,  
**so that** I can understand what exercises I need to complete and track my progress through the day.

## Acceptance Criteria

1. **Day overview display** shows current day's exercises with estimated duration and progress, with AMRAP day detection and specialized round-based display format
2. **Exercise list** displays all exercises in the current day with sets, reps, rest periods, time durations in natural format (e.g., "30 seconds", "5 minutes", "1 hour"), and distances in natural format (e.g., "20 meters", "1 mile", "5 miles")
3. **Progress indicators** show completion status for each exercise in the day, with round-based progress tracking for AMRAP workouts
4. **AMRAP day presentation** displays exercises as rounds with clear indication of "complete all exercises then repeat" flow and time duration remaining
5. **Day navigation** allows users to start the workout and navigate between exercises
6. **Time estimates** display estimated total day duration and time remaining using natural time formatting from exercise duration specifications, with AMRAP timer countdown display
7. **Mobile optimization** provides touch-friendly interface optimized for gym use
8. **Day status tracking** maintains current position within the workout day, including round completion for AMRAP workouts
9. **Exercise preview** shows exercise names and basic information
10. **Day completion tracking** enables tracking of overall day progress
11. **Error handling** gracefully handles day data issues and provides user feedback

## Tasks / Subtasks

- [x] Create workout dashboard page component (AC: 1, 7, 11)
  - [x] Implement `src/app/(frontend)/workout/dashboard/page.tsx` as server component
  - [x] Add protected route authentication using auth middleware
  - [x] Implement error boundaries for dashboard-level error handling
  
- [ ] Build day overview display component (AC: 1, 4)
  - [ ] Create `src/components/workout/day-overview.tsx` component
  - [ ] Implement AMRAP day detection using `isAmrapDay` type guard
  - [ ] Add specialized AMRAP round-based display with timer countdown
  - [ ] Use embedded program structure for single-query data access
  
- [ ] Implement exercise list component (AC: 2, 9)
  - [ ] Create `src/components/workout/exercise-list.tsx` component
  - [ ] Integrate `formatDistance` and `formatDuration` utilities for natural formatting
  - [ ] Display sets, reps, rest periods, weight, time, and distance specifications
  - [ ] Use `hasDistance` and `hasDuration` type guards for conditional rendering
  
- [ ] Add progress indicators component (AC: 3, 8, 10)
  - [ ] Create `src/components/workout/progress-indicators.tsx` component
  - [ ] Implement round-based progress tracking for AMRAP workouts
  - [ ] Show completion status for each exercise using completion tracking
  - [ ] Add day-level progress tracking with current position persistence
  
- [ ] Build day navigation component (AC: 5)
  - [ ] Create `src/components/workout/day-navigation.tsx` component
  - [ ] Implement start workout functionality with session initialization
  - [ ] Add navigation to individual exercises using Next.js routing
  - [ ] Use Zustand workout store for state management
  
- [ ] Implement time estimates component (AC: 6)
  - [ ] Create `src/components/workout/time-estimates.tsx` component
  - [ ] Calculate total day duration from exercise duration specifications
  - [ ] Implement AMRAP timer countdown display using JavaScript timers
  - [ ] Show time remaining based on current progress through exercises
  
- [ ] Add mobile optimization (AC: 7)
  - [ ] Apply Tailwind CSS mobile-first responsive design patterns
  - [ ] Implement touch-friendly UI elements using ShadCN components
  - [ ] Optimize for gym use with large touch targets and clear visibility
  - [ ] Test on mobile devices for optimal gym experience
  
- [ ] Integrate Zustand state management (AC: 8)
  - [ ] Use `useWorkoutStore` for current program and progress state
  - [ ] Implement day position tracking with persistence
  - [ ] Handle AMRAP round completion state management
  - [ ] Ensure state updates trigger UI re-renders appropriately
  
- [ ] Add unit testing (Testing Standards)
  - [ ] Create `tests/components/workout/day-overview.test.tsx` using Vitest + Testing Library
  - [ ] Create `tests/components/workout/exercise-list.test.tsx` with formatter integration tests
  - [ ] Create `tests/components/workout/progress-indicators.test.tsx` with AMRAP progress tests
  - [ ] Test AMRAP day detection and time calculations
  - [ ] Mock PayloadCMS data and Zustand state for component isolation

## Dev Notes

### Previous Story Insights
No previous stories exist - this is the first story in the project.

### Data Models
**Program Structure (Embedded Schema):** [Source: architecture/payloadcms-data-architecture.md#programs-collection-schema]
- Programs contain embedded milestones, days, and exercise configurations
- Day fields: `dayType`, `isAmrap`, `amrapDuration`, `restNotes`
- ExerciseConfig fields: `exercise` (relationship), `sets`, `reps`, `restPeriod`, `weight`, `durationValue`, `durationUnit`, `distanceValue`, `distanceUnit`, `notes`
- Single query access to complete program structure via embedded documents

**Product User Progress Tracking:** [Source: architecture/backend-architecture.md#payloadcms-local-api-data-access]
- Product users have `currentProgram`, `currentMilestone`, `currentDay` fields for position tracking
- Exercise completions tracked in separate `exerciseCompletions` collection with relationships to exercises and users

### API Specifications
**Server Component Data Fetching:** [Source: architecture/frontend-architecture.md#server-component-data-fetching]
- Use `getPayload()` and PayloadCMS Local API for type-safe data access
- Server components can directly query PayloadCMS collections without additional API layer
- Authentication via `getCurrentProductUser()` helper function

**Workout Store Integration:** [Source: architecture/frontend-architecture.md#zustand-store-structure]
- `useWorkoutStore` provides: `currentProgram`, `currentMilestoneIndex`, `currentDayIndex`, `currentExerciseIndex`, `completedExercises`
- Helper methods: `getCurrentDay()`, `getCurrentExercise()`, `setCurrentDay()`, `completeExercise()`
- Session management: `sessionStartTime`, `startSession()` for workout timing

### Component Specifications
**Component Architecture:** [Source: architecture/frontend-architecture.md#component-organization]
- Workout components located in `src/components/workout/`
- Use ShadCN base components from `src/components/ui/`
- Follow kebab-case file naming convention (required)

**Exercise Display Integration:** [Source: architecture/exercise-formatting-utilities.md#component-integration-patterns]
- Use `formatDistance(distanceValue, distanceUnit)` for distance display
- Use `formatDuration(durationValue, durationUnit)` for time display  
- Use `formatExerciseSpecs(exercise)` for complete exercise specification formatting
- Import from `@/utils/formatters` consolidated export

**Type Safety Patterns:** [Source: architecture/backend-architecture.md#type-safety-patterns]
- Use `isAmrapDay(day)` type guard for AMRAP day detection
- Use `hasDistance(exercise)` and `hasDuration(exercise)` type guards
- All types auto-generated by PayloadCMS from collection schemas

### File Locations
**Page Location:** `src/app/(frontend)/workout/dashboard/page.tsx` [Source: architecture/unified-project-structure.md]
**Component Locations:** `src/components/workout/` directory [Source: architecture/unified-project-structure.md]
**Store Location:** `src/stores/workout-store.ts` (existing) [Source: architecture/unified-project-structure.md]
**Utility Locations:** `src/utils/formatters.ts` [Source: architecture/exercise-formatting-utilities.md#master-export-file]

### Testing Requirements
**Testing Strategy:** [Source: architecture/testing-strategy.md#test-organization]
- Frontend component tests in `tests/components/workout/` directory
- Use Vitest + Testing Library for React component testing
- Test custom business logic and user interfaces (not framework functionality)
- Focus on exercise formatting, AMRAP detection, and progress tracking logic

**Testing Approach:** [Source: architecture/testing-strategy.md#core-testing-philosophy]
- Do NOT test Next.js routing or PayloadCMS collection operations
- DO test custom React components, formatting utilities, and business logic
- Mock PayloadCMS data and Zustand state for component isolation
- Test AMRAP-specific functionality and exercise display formatting

### Technical Constraints
**Technology Stack:** [Source: architecture/tech-stack.md]
- Next.js 15.5+ with App Router
- TypeScript 5.3+ for type safety
- Tailwind CSS 4.1+ for mobile-first styling
- ShadCN/ui components for consistent UI
- Zustand for state management

**Coding Standards:** [Source: architecture/coding-standards.md#critical-fullstack-rules]
- Use kebab-case for all file names (strictly enforced)
- Server actions for data mutations, PayloadCMS Local API for queries
- Type sharing from `src/types/` directory
- Proper error handling with Zod validation

## Testing

**Test File Locations:** `tests/components/workout/` [Source: architecture/testing-strategy.md#test-organization]

**Testing Standards:**
- Use Vitest + Testing Library for component unit tests
- Focus on business logic: exercise formatting, AMRAP detection, progress calculations
- Mock PayloadCMS data structures and Zustand store state
- Test mobile-optimized UI interactions and touch-friendly elements

**Key Test Scenarios:**
- AMRAP day detection and round-based display
- Exercise specification formatting with distance and duration
- Progress indicator accuracy for completed vs remaining exercises
- Time estimation calculations for workout duration
- Error handling for missing or invalid day data

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-11 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used

Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

*To be filled by dev agent*

### Completion Notes List

- **Task 1 Completed**: Created workout dashboard page component with server-side authentication and error boundaries
  - Implemented protected route using `getCurrentProductUser()` pattern
  - Added Next.js error boundary for dashboard-level error handling
  - Used mobile-first responsive design with Tailwind CSS
  - Created placeholder structure for future component integration

### File List

**New Files:**
- `src/app/(frontend)/workout/dashboard/page.tsx` - Main dashboard page with authentication
- `src/app/(frontend)/workout/dashboard/error.tsx` - Error boundary component

## QA Results

*Results from QA Agent review will be populated here after implementation.*